<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TAC Editor - Aviation Meteorology Message Editor | @softwarity/tac-editor</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="A powerful, lightweight Web Component for editing TAC (Traditional Alphanumeric Codes) aviation meteorology messages including METAR, SPECI, TAF, SIGMET, VAA, TCA and SWXA with syntax highlighting and intelligent autocompletion.">
  <meta name="keywords" content="tac, metar, speci, taf, sigmet, airmet, vaa, tca, swxa, space weather, aviation, meteorology, weather, editor, web component, syntax highlighting, autocompletion, iwxxm">
  <meta name="author" content="Softwarity">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://softwarity.github.io/tac-editor/">
  <meta property="og:title" content="TAC Editor - Aviation Meteorology Message Editor">
  <meta property="og:description" content="A powerful Web Component for editing TAC aviation meteorology messages with syntax highlighting and intelligent autocompletion.">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://softwarity.github.io/tac-editor/">
  <meta name="twitter:title" content="TAC Editor - Aviation Meteorology Message Editor">
  <meta name="twitter:description" content="A powerful Web Component for editing TAC aviation meteorology messages with syntax highlighting and intelligent autocompletion.">

  <!-- Canonical URL -->
  <link rel="canonical" href="https://softwarity.github.io/tac-editor/">

  <!-- Material Symbols -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=code,content_copy,dark_mode,download,light_mode,palette,refresh" rel="stylesheet">

  <!-- Prism.js for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "TAC Editor",
    "applicationCategory": "DeveloperApplication",
    "operatingSystem": "Web Browser",
    "description": "A feature-rich TAC editor Web Component for aviation meteorology messages with syntax highlighting and intelligent autocompletion",
    "url": "https://softwarity.github.io/tac-editor/",
    "author": {
      "@type": "Organization",
      "name": "Softwarity",
      "url": "https://www.softwarity.io/"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "license": "https://opensource.org/licenses/MIT"
  }
  </script>

  <style>
    :root {
      --bg-canvas: #0d1117;
      --bg-primary: #161b22;
      --bg-secondary: #21262d;
      --border-default: #30363d;
      --text-primary: #e6edf3;
      --text-secondary: #c9d1d9;
      --text-muted: #8b949e;
      --accent-blue: #58a6ff;
      --accent-green: #238636;
      --accent-green-hover: #2ea043;
      --accent-purple: #a371f7;
      --accent-orange: #d29922;
      --accent-red: #f85149;
      --font-mono: 'Courier New', monospace;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* Color scheme toggle (Tailwind pattern) */
    html.dark { color-scheme: dark; }
    html:not(.dark) { color-scheme: light; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 2rem;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--bg-primary);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      border: 1px solid var(--border-default);
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-left img {
      height: 40px;
    }

    .header-right {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    h1 { color: var(--text-primary); font-size: 2rem; margin: 0; }

    .badge-container {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }

    .badge-container img {
      height: 20px;
    }

    .github-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background 0.2s;
      border: 1px solid var(--border-default);
    }
    .github-link:hover { background: var(--border-default); }
    .github-link svg { width: 20px; height: 20px; fill: currentColor; flex-shrink: 0; }

    /* Section styles */
    .section-box {
      margin-top: 2rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border-default);
    }
    .section-box h3 { color: var(--text-primary); margin-bottom: 0.5rem; }
    .section-box p { color: var(--text-muted); }

    .section-box pre {
      background: var(--bg-canvas);
      color: var(--text-secondary);
      padding: 1rem;
      border-radius: 4px;
      overflow: auto;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      border: 1px solid var(--border-default);
    }

    .text-muted { color: var(--text-muted); font-size: 0.85rem; }
    .description { color: var(--text-muted); margin-bottom: 2rem; line-height: 1.6; }
    .description strong { color: var(--text-secondary); }

    /* Controls */
    .controls {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border-default);
    }

    .controls-section { display: flex; flex-direction: column; gap: 1rem; }
    .controls-section h4 {
      margin: 0;
      color: var(--text-primary);
      font-size: 1rem;
      border-bottom: 2px solid var(--accent-blue);
      padding-bottom: 0.5rem;
    }
    .controls-section > p { color: var(--text-muted); font-size: 0.85rem; }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
    .control-group label { font-weight: 600; color: var(--text-secondary); font-size: 0.9rem; }

    .control-group select,
    .control-group input[type="text"] {
      padding: 0.5rem;
      border: 1px solid var(--border-default);
      border-radius: 4px;
      font-size: 0.9rem;
      font-family: var(--font-mono);
      background: var(--bg-canvas);
      color: var(--text-secondary);
    }

    .control-group select:focus,
    .control-group input[type="text"]:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .checkbox-group { display: flex; align-items: center; gap: 0.5rem; }
    .checkbox-group label { margin: 0; color: var(--text-secondary); font-weight: normal; }

    .types-checkboxes {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 1rem;
    }

    .checkbox-inline {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: var(--text-secondary);
      font-size: 0.85rem;
      cursor: pointer;
    }

    .checkbox-inline input[type="checkbox"] {
      accent-color: var(--accent-blue);
    }

    .info-box {
      background: var(--bg-canvas);
      padding: 0.75rem;
      border-radius: 4px;
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-muted);
      border-left: 3px solid var(--accent-blue);
    }

    /* Editor container */
    .editor-container {
      padding: 1rem;
      background: var(--bg-secondary);
      border: 1px solid rgba(88, 166, 255, 0.4);
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .editor-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 0 0 0.5rem 0;
      color: var(--text-primary);
      font-weight: 600;
    }

    .editor-actions {
      display: flex;
      gap: 0.15rem;
      align-items: center;
    }

    .editor-checkbox {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
      font-weight: normal;
      cursor: pointer;
    }

    .editor-actions button {
      padding: 0.2rem 0.4rem;
      font-size: 0.9rem;
      border-radius: 4px;
      border: 1px solid var(--border-default);
      background: var(--bg-primary);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
      line-height: 1;
    }

    .editor-actions button:hover {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    /* Icon buttons */
    .btn-icon {
      padding: 0.35rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
    }

    /* Material Symbols styling */
    .material-symbols-outlined {
      font-size: 18px;
      vertical-align: middle;
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 20;
    }

    tac-editor {
      min-height: 400px;
      font-size: 14px;
    }

    /* Sample messages */
    .samples {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .sample-card {
      background: var(--bg-canvas);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .sample-card:hover {
      border-color: var(--accent-blue);
      transform: translateY(-2px);
    }

    .sample-card h4 {
      color: var(--accent-blue);
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .sample-card code {
      display: block;
      color: var(--text-secondary);
      font-family: var(--font-mono);
      font-size: 0.8rem;
      word-break: break-all;
      line-height: 1.4;
    }

    /* Log container */
    .log-container {
      position: relative;
    }

    .log-container pre {
      max-height: 200px;
      overflow-y: auto;
      padding-bottom: 2.5rem;
    }

    .btn-clear {
      position: absolute;
      bottom: 0.5rem;
      right: 1.5rem;
      padding: 0.2rem 0.4rem;
      font-size: 0.9rem;
      opacity: 0.5;
      cursor: pointer;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      color: var(--text-muted);
      border-radius: 4px;
      line-height: 1;
    }

    .btn-clear:hover {
      opacity: 1;
    }

    /* Message types legend */
    .message-types {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .message-type-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: bold;
      font-family: var(--font-mono);
    }

    .message-type-badge.metar { background: rgba(86, 156, 214, 0.2); color: #569cd6; }
    .message-type-badge.taf { background: rgba(78, 201, 176, 0.2); color: #4ec9b0; }
    .message-type-badge.sigmet { background: rgba(248, 81, 73, 0.2); color: #f85149; }
    .message-type-badge.airmet { background: rgba(210, 153, 34, 0.2); color: #d29922; }
    .message-type-badge.vaa { background: rgba(163, 113, 247, 0.2); color: #a371f7; }
    .message-type-badge.tca { background: rgba(197, 134, 192, 0.2); color: #c586c0; }
    .message-type-badge.swxa { background: rgba(56, 189, 248, 0.2); color: #38bdf8; }

    /* Footer */
    .footer {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-default);
      text-align: center;
    }

    .footer a {
      color: var(--text-muted);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .footer a:hover {
      color: var(--text-secondary);
    }

    .footer img {
      height: 20px;
      opacity: 0.7;
    }

    /* Prism.js syntax highlighting */
    .code-example .token.comment, .code-example .token.prolog, .code-example .token.doctype { color: var(--text-muted); }
    .code-example .token.punctuation, .code-example .token.operator, .code-example .token.entity, .code-example .token.url, .code-example .token.variable { color: var(--text-secondary); }
    .code-example .token.property, .code-example .token.tag, .code-example .token.boolean, .code-example .token.number, .code-example .token.constant, .code-example .token.symbol { color: #79c0ff; }
    .code-example .token.selector, .code-example .token.attr-name, .code-example .token.string, .code-example .token.char, .code-example .token.builtin { color: #a5d6ff; }
    .code-example .token.atrule, .code-example .token.attr-value, .code-example .token.keyword { color: #ff7b72; }
    .code-example .token.function { color: #d2a8ff; }
    .code-example .token.regex, .code-example .token.important { color: #ffa657; }

    /* Suggestion Providers Section */
    .providers-section {
      margin-top: 1rem;
    }

    /* First level tabs: Message Types */
    .message-type-tabs {
      display: flex;
      gap: 0;
      border-bottom: 2px solid var(--border-default);
      margin-bottom: 1rem;
    }

    .message-type-tab {
      padding: 0.75rem 1.5rem;
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .message-type-tab:hover {
      color: var(--text-secondary);
      background: var(--bg-secondary);
    }

    .message-type-tab.active {
      color: var(--accent-blue);
      border-bottom-color: var(--accent-blue);
    }

    .message-type-content {
      display: none;
    }

    .message-type-content.active {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Sub-tabs for providers */
    .provider-subtabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--border-default);
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .provider-subtab {
      padding: 0.5rem 1rem;
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 0.85rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      transition: all 0.2s;
    }

    .provider-subtab:hover {
      color: var(--text-secondary);
      background: var(--bg-canvas);
    }

    .provider-subtab.active {
      color: var(--accent-purple);
      border-bottom-color: var(--accent-purple);
    }

    .provider-subcontent {
      display: none;
    }

    .provider-subcontent.active {
      display: block;
    }

    /* Provider Cards */
    .provider-card {
      border: 1px solid var(--border-default);
      border-radius: 8px;
      padding: 1rem;
      background: var(--bg-secondary);
    }

    .provider-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .provider-header h4 {
      color: var(--text-primary);
      margin: 0;
      font-size: 0.95rem;
    }

    .provider-controls {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      width: 100%;
      margin: 0.75rem 0;
    }

    .provider-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .provider-row-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      width: 100%;
    }

    .provider-row-header .provider-row-label {
      flex-shrink: 0;
    }

    .provider-row-header .provider-spacer {
      flex: 1;
    }

    .provider-row-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .provider-spacer {
      flex: 1;
    }

    .provider-toggle {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      cursor: pointer;
    }

    .provider-toggle span {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .provider-input {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .provider-input span {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .provider-input input[type="number"] {
      width: 60px;
      padding: 2px 4px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 3px;
      color: var(--text);
      font-size: 0.8rem;
    }

    .provider-input input[type="text"] {
      width: 120px;
      padding: 2px 6px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 3px;
      color: var(--text);
      font-size: 0.8rem;
    }

    .provider-toggle input[type="checkbox"] {
      accent-color: var(--accent-blue);
      cursor: pointer;
    }

    .provider-desc {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin: 0 0 0.75rem 0;
    }

    .provider-desc code {
      background: var(--bg-tertiary);
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
      font-size: 0.8rem;
    }

    .provider-info {
      margin-top: 1rem;
      padding: 0.75rem;
      background: var(--bg-tertiary);
      border-radius: 6px;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .provider-info p {
      margin: 0 0 0.5rem 0;
    }

    .provider-info ul {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }

    .provider-info li {
      margin: 0.25rem 0;
    }

    .provider-info code {
      background: var(--bg-secondary);
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
      font-size: 0.8rem;
    }

    .provider-json {
      position: relative;
    }

    .provider-json textarea {
      width: 100%;
      min-height: 200px;
      padding: 1rem;
      border: 1px solid var(--border-default);
      border-radius: 6px;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      background: var(--bg-canvas);
      color: var(--text-primary);
      resize: vertical;
    }

    .provider-json textarea:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .provider-json textarea:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .provider-json-error {
      color: var(--accent-red);
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }

    .provider-code-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.5rem 0.75rem;
      margin-top: 0.5rem;
      background: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background 0.2s;
    }

    .provider-code-btn:hover {
      background: var(--accent-blue-hover, #2563eb);
    }

    .provider-code-btn .material-symbols-outlined {
      font-size: 1rem;
    }

    .code-container {
      max-height: 400px;
      overflow: auto;
      border-radius: 6px;
      margin-bottom: 1rem;
      background: #2d2d2d;
    }

    .code-container pre {
      margin: 0;
      border-radius: 6px;
      background: #2d2d2d !important;
      padding: 1rem !important;
    }

    .code-container pre code {
      font-family: 'Fira Code', 'Monaco', 'Menlo', monospace;
      font-size: 0.85rem;
      line-height: 1.5;
      background: transparent !important;
    }

    /* Provider Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.visible {
      display: flex;
    }

    .modal {
      background: var(--bg-primary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .modal h3 {
      color: var(--text-primary);
      margin: 0 0 0.5rem 0;
    }

    .modal p {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin: 0 0 1rem 0;
      line-height: 1.5;
    }

    .modal-input-group {
      margin-bottom: 1rem;
    }

    .modal-input-group label {
      display: block;
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    .modal-input-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-default);
      border-radius: 6px;
      font-size: 1rem;
      font-family: var(--font-mono);
      background: var(--bg-canvas);
      color: var(--text-primary);
    }

    .modal-input-group input:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .modal-info {
      background: var(--bg-canvas);
      padding: 0.75rem;
      border-radius: 4px;
      font-size: 0.8rem;
      color: var(--text-muted);
      border-left: 3px solid var(--accent-purple);
      margin-bottom: 1rem;
    }

    .modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
    }

    .modal-actions button {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-cancel {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      color: var(--text-secondary);
    }

    .btn-cancel:hover {
      background: var(--border-default);
    }

    .btn-confirm {
      background: var(--accent-blue);
      border: 1px solid var(--accent-blue);
      color: white;
    }

    .btn-confirm:hover {
      background: #4090e0;
    }

    /* Theme Modal */
    .theme-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .theme-modal.visible {
      display: flex;
    }

    .theme-modal-backdrop {
      position: absolute;
      inset: 0;
    }

    .theme-modal-content {
      position: relative;
      background: var(--bg-primary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 700px;
      width: 90%;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .theme-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .theme-modal-header h3 {
      color: var(--text-primary);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .theme-modal-header h3 .material-symbols-outlined {
      font-size: 24px;
    }

    .theme-modal-close {
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.25rem;
      line-height: 1;
    }

    .theme-modal-close:hover {
      color: var(--text-primary);
    }

    .theme-modal-body p {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin-bottom: 1rem;
    }

    .theme-modal-body code {
      background: var(--bg-canvas);
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
      font-size: 0.8rem;
    }

    .theme-textarea {
      width: 100%;
      min-height: 350px;
      padding: 1rem;
      border: 1px solid var(--border-default);
      border-radius: 6px;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      background: var(--bg-canvas);
      color: var(--text-primary);
      resize: vertical;
      line-height: 1.4;
    }

    .theme-textarea:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .theme-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      margin-top: 1rem;
    }

    .theme-actions button {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-accent {
      background: var(--accent-purple) !important;
      border-color: var(--accent-purple) !important;
    }

    .btn-accent:hover {
      background: #8b5cf6 !important;
    }

    /* Responsive */
    @media (max-width: 768px) {
      body { padding: 1rem; }
      .container { padding: 1rem; }
      h1 { font-size: 1.5rem; }
      .header { flex-direction: column; align-items: flex-start; }
      .header-right { width: 100%; justify-content: flex-start; }
    }

    @media (max-width: 600px) {
      .github-link { padding: 0.5rem; }
      .github-link .link-text { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <a href="https://www.softwarity.io/" target="_blank" rel="noopener noreferrer" title="Softwarity">
          <img src="https://www.softwarity.io/img/softwarity.svg" alt="Softwarity">
        </a>
        <div>
          <h1>@softwarity/tac-editor</h1>
          <div class="badge-container">
            <a href="https://www.npmjs.com/package/@softwarity/tac-editor" target="_blank" rel="noopener">
              <img src="https://img.shields.io/npm/v/@softwarity/tac-editor?color=blue&label=npm" alt="npm version">
            </a>
            <a href="https://bundlephobia.com/package/@softwarity/tac-editor" target="_blank" rel="noopener">
              <img src="https://img.shields.io/bundlephobia/minzip/@softwarity/tac-editor?label=size" alt="bundle size">
            </a>
            <a href="https://github.com/softwarity/tac-editor/blob/main/LICENSE" target="_blank" rel="noopener">
              <img src="https://img.shields.io/badge/license-MIT-blue" alt="license">
            </a>
          </div>
        </div>
      </div>
      <div class="header-right">
        <a href="https://github.com/softwarity/tac-editor#readme" target="_blank" rel="noopener noreferrer" class="github-link">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M0 1.75A.75.75 0 01.75 1h4.253c1.227 0 2.317.59 3 1.501A3.744 3.744 0 0111.006 1h4.245a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-4.507a2.25 2.25 0 00-1.591.659l-.622.621a.75.75 0 01-1.06 0l-.622-.621A2.25 2.25 0 005.258 13H.75a.75.75 0 01-.75-.75V1.75zm8.755 3a2.25 2.25 0 012.25-2.25H14.5v9h-3.757c-.71 0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324l.004-5.073-.002-2.253A2.25 2.25 0 005.003 2.5H1.5v9h3.757a3.75 3.75 0 011.994.574z"></path>
          </svg>
          <span class="link-text">Documentation</span>
        </a>
        <a href="https://github.com/softwarity/tac-editor" target="_blank" rel="noopener noreferrer" class="github-link">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
          </svg>
          <span class="link-text">GitHub</span>
        </a>
      </div>
    </div>

    <!-- Description -->
    <p class="description">
      A lightweight Web Component for editing TAC (Traditional Alphanumeric Codes) aviation meteorology messages —
      with built-in <strong>syntax highlighting</strong>, <strong>validation</strong>, and <strong>autocompletion</strong>.
      <span style="color: var(--text-muted);">Supports METAR, SPECI, TAF, SIGMET, AIRMET, VAA, TCA, and SWXA formats.</span>
    </p>

    <!-- Supported message types -->
    <div class="message-types">
      <span class="message-type-badge metar">METAR</span>
      <span class="message-type-badge metar">SPECI</span>
      <span class="message-type-badge taf">TAF</span>
      <span class="message-type-badge sigmet">SIGMET</span>
      <span class="message-type-badge airmet">AIRMET</span>
      <span class="message-type-badge vaa">VAA</span>
      <span class="message-type-badge tca">TCA</span>
      <span class="message-type-badge swxa">SWXA</span>
    </div>

    <!-- Controls -->
    <div class="controls">
      <div class="controls-section">
        <h4>Theme</h4>
        <div class="controls-grid">
          <div class="control-group">
            <label for="themePresetSelect">Theme Preset</label>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
              <select id="themePresetSelect" style="flex: 1; height: 32px;" onchange="changeThemePreset()">
                <option value="" selected>Default (IntelliJ)</option>
                <option value="vscode">VS Code</option>
                <option value="monokai">Monokai</option>
                <option value="github">GitHub</option>
                <option value="solarized">Solarized</option>
              </select>
              <button class="btn-icon btn-accent" onclick="openThemeModal()" title="View theme CSS"><span class="material-symbols-outlined">palette</span></button>
              <button class="btn-icon" id="colorSchemeToggle" onclick="toggleColorScheme()" title="Toggle light/dark mode"><span class="material-symbols-outlined">dark_mode</span></button>
            </div>
          </div>
        </div>
      </div>

      <div class="controls-section">
        <h4>Editor Options</h4>
        <div class="controls-grid">
          <div class="control-group">
            <label for="variantSelect">Standard & Language</label>
            <select id="variantSelect">
              <option value="oaci.en" selected>OACI/ICAO - English</option>
              <option value="oaci.fr">OACI/ICAO - Français</option>
              <option value="noaa.en">NOAA (US) - English</option>
            </select>
          </div>
          <div class="control-group" style="grid-column: 1 / -1;">
            <label>Allowed Message Types</label>
            <div class="types-checkboxes">
              <label class="checkbox-inline" title="Toggle all"><input type="checkbox" id="toggleAllTypes" checked onchange="toggleAllTypes()"> All</label>
              <span style="border-left: 1px solid var(--border-color); margin: 0 0.5rem;"></span>
              <label class="checkbox-inline" title="METAR"><input type="checkbox" value="SA" checked onchange="updateTypes()"> SA</label>
              <label class="checkbox-inline" title="SPECI"><input type="checkbox" value="SP" checked onchange="updateTypes()"> SP</label>
              <label class="checkbox-inline" title="TAF Court"><input type="checkbox" value="FC" checked onchange="updateTypes()"> FC</label>
              <label class="checkbox-inline" title="TAF Long"><input type="checkbox" value="FT" checked onchange="updateTypes()"> FT</label>
              <label class="checkbox-inline" title="SIGMET Weather"><input type="checkbox" value="WS" checked onchange="updateTypes()"> WS</label>
              <label class="checkbox-inline" title="SIGMET Volcanic Ash"><input type="checkbox" value="WV" checked onchange="updateTypes()"> WV</label>
              <label class="checkbox-inline" title="SIGMET Tropical Cyclone"><input type="checkbox" value="WC" checked onchange="updateTypes()"> WC</label>
              <label class="checkbox-inline" title="AIRMET"><input type="checkbox" value="WA" checked onchange="updateTypes()"> WA</label>
              <label class="checkbox-inline" title="Volcanic Ash Advisory"><input type="checkbox" value="FV" checked onchange="updateTypes()"> FV</label>
              <label class="checkbox-inline" title="Tropical Cyclone Advisory"><input type="checkbox" value="FK" checked onchange="updateTypes()"> FK</label>
              <label class="checkbox-inline" title="Space Weather Advisory"><input type="checkbox" value="FN" checked onchange="updateTypes()"> FN</label>
            </div>
          </div>
          <div class="control-group" style="grid-column: 1 / -1;">
            <label>Observation Options (METAR/SPECI)</label>
            <div class="types-checkboxes">
              <label class="checkbox-inline" title="Include AUTO station entries (////,  /////KT, NCD, etc.)">
                <input type="checkbox" id="observationAuto" onchange="toggleObservationAuto()"> Show AUTO entries
              </label>
            </div>
          </div>
        </div>
        <div class="info-box">
          <strong>Note:</strong> The <code>message-types</code> attribute restricts which TAC codes the editor will accept.
          Only grammars for selected types will be loaded when detected. Leave unchecked types for a more restrictive editor.
        </div>
      </div>
    </div>

    <!-- Editor -->
    <div class="editor-container">
      <div class="editor-label">
        <span>TAC Editor</span>
        <div class="editor-actions">
          <label class="editor-checkbox">
            <input type="checkbox" id="readonlyToggle2" onchange="toggleReadonly()">
            <span>Readonly</span>
          </label>
          <button class="btn-icon" onclick="resetEditor()" title="Reset to sample"><span class="material-symbols-outlined">refresh</span></button>
          <button class="btn-icon" onclick="copyToClipboard()" title="Copy to clipboard"><span class="material-symbols-outlined">content_copy</span></button>
        </div>
      </div>
      <tac-editor id="editor" grammars-url="../grammars"></tac-editor>
    </div>

    <!-- Suggestion Providers -->
    <div class="section-box">
      <h3>Suggestion Providers</h3>
      <p>Configure dynamic suggestion providers for token types. Providers can <strong>replace</strong> grammar suggestions or <strong>extend</strong> them.</p>

      <div class="providers-section">
        <!-- First level: Message Types -->
        <div class="message-type-tabs">
          <button class="message-type-tab active" data-type="METAR" onclick="switchMessageTypeTab('METAR')">METAR / SPECI / TAF</button>
          <button class="message-type-tab" data-type="SIGMET" onclick="switchMessageTypeTab('SIGMET')">SIGMET / AIRMET</button>
          <button class="message-type-tab" data-type="VAA" onclick="switchMessageTypeTab('VAA')">VAA</button>
        </div>

        <!-- METAR/SPECI/TAF Providers -->
        <div id="providers-METAR" class="message-type-content active">
          <div class="provider-subtabs">
            <button class="provider-subtab active" data-subtab="metar-reportIcao" onclick="switchProviderSubtab('METAR', 'reportIcao')">METAR/SPECI Aerodrome</button>
            <button class="provider-subtab" data-subtab="metar-tafIcao" onclick="switchProviderSubtab('METAR', 'tafIcao')">TAF Aerodrome</button>
            <button class="provider-subtab" data-subtab="metar-weather" onclick="switchProviderSubtab('METAR', 'weather')">Weather Phenomena</button>
            <button class="provider-subtab" data-subtab="metar-wind" onclick="switchProviderSubtab('METAR', 'wind')">Wind (API)</button>
          </div>

          <!-- METAR/SPECI Aerodrome Provider -->
          <div id="metar-subcontent-reportIcao" class="provider-subcontent active">
            <div class="provider-card">
              <div class="provider-header">
                <h4>sa.*.*.icao, sp.*.*.icao</h4>
              </div>
              <p class="provider-desc">ICAO location indicator for METAR/SPECI observation reports (format: <code>nnnn</code>)</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="reportIcaoLabel" value="" placeholder="(auto)" onchange="updateProviderOption('reportIcao', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="reportIcaoReplaceMode" checked onchange="toggleReplaceMode('reportIcao')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="reportIcaoCategory" onchange="toggleCategoryMode('reportIcao')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="reportIcaoCache" onchange="updateProviderOption('reportIcao', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="reportIcaoUserInteraction" onchange="updateProviderOption('reportIcao', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="reportIcaoTimeout" value="500" min="0" step="100" onchange="updateProviderOption('reportIcao', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="reportIcaoProviderEnabled" checked onchange="toggleProvider('reportIcao')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="reportIcaoDelay" value="0" min="0" step="100" onchange="updateProviderOption('reportIcao', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="reportIcaoProviderJson" spellcheck="false" onchange="updateProviderData('reportIcao')">[
  { "text": "LFPG", "description": "Paris CDG" },
  { "text": "LFPO", "description": "Paris Orly" },
  { "text": "LFBO", "description": "Toulouse Blagnac" },
  { "text": "LFML", "description": "Marseille Provence" },
  { "text": "LFBD", "description": "Bordeaux Mérignac" },
  { "text": "LFLL", "description": "Lyon Saint-Exupéry" }
]</textarea>
                <div id="reportIcaoProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('reportIcao')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>

          <!-- TAF Aerodrome Provider -->
          <div id="metar-subcontent-tafIcao" class="provider-subcontent">
            <div class="provider-card">
              <div class="provider-header">
                <h4>ft.*.*.icao, fc.*.*.icao</h4>
              </div>
              <p class="provider-desc">ICAO location indicator for TAF forecasts (format: <code>nnnn</code>)</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="tafIcaoLabel" value="" placeholder="(auto)" onchange="updateProviderOption('tafIcao', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="tafIcaoReplaceMode" checked onchange="toggleReplaceMode('tafIcao')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="tafIcaoCategory" onchange="toggleCategoryMode('tafIcao')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="tafIcaoCache" onchange="updateProviderOption('tafIcao', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="tafIcaoUserInteraction" onchange="updateProviderOption('tafIcao', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="tafIcaoTimeout" value="500" min="0" step="100" onchange="updateProviderOption('tafIcao', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="tafIcaoProviderEnabled" checked onchange="toggleProvider('tafIcao')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="tafIcaoDelay" value="0" min="0" step="100" onchange="updateProviderOption('tafIcao', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="tafIcaoProviderJson" spellcheck="false" onchange="updateProviderData('tafIcao')">[
  { "text": "LFPG", "description": "Paris CDG" },
  { "text": "LFPO", "description": "Paris Orly" },
  { "text": "LFBO", "description": "Toulouse Blagnac" },
  { "text": "EGLL", "description": "London Heathrow" },
  { "text": "EHAM", "description": "Amsterdam Schiphol" }
]</textarea>
                <div id="tafIcaoProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('tafIcao')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>

          <!-- Weather Phenomena Provider -->
          <div id="metar-subcontent-weather" class="provider-subcontent">
            <div class="provider-card">
              <div class="provider-header">
                <h4>sa.*.*.weather, sp.*.*.weather</h4>
              </div>
              <p class="provider-desc">Prioritize specific weather phenomena at the top of suggestions</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="weatherLabel" value="" placeholder="(auto)" onchange="updateProviderOption('weather', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="weatherReplaceMode" onchange="toggleReplaceMode('weather')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="weatherCategory" onchange="toggleCategoryMode('weather')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="weatherCache" onchange="updateProviderOption('weather', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="weatherUserInteraction" onchange="updateProviderOption('weather', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="weatherTimeout" value="500" min="0" step="100" onchange="updateProviderOption('weather', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="weatherProviderEnabled" checked onchange="toggleProvider('weather')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="weatherDelay" value="0" min="0" step="100" onchange="updateProviderOption('weather', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="weatherProviderJson" spellcheck="false" onchange="updateProviderData('weather')">[
  { "text": "-RA", "description": "Light rain (common)" },
  { "text": "RA", "description": "Moderate rain (common)" },
  { "text": "BR", "description": "Mist (common)" },
  { "text": "FG", "description": "Fog (common)" },
  { "text": "SHRA", "description": "Rain showers (common)" },
  { "text": "TS", "description": "Thunderstorm" },
  { "text": "TSRA", "description": "Thunderstorm with rain" }
]</textarea>
                <div id="weatherProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('weather')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>

          <!-- Wind Provider (API) -->
          <div id="metar-subcontent-wind" class="provider-subcontent">
            <div class="provider-card">
              <div class="provider-header">
                <h4>sa.*.*.windDirection, sp.*.*.windDirection</h4>
              </div>
              <p class="provider-desc">
                Fetch real-time wind data from <a href="https://open-meteo.com/" target="_blank">Open-Meteo API</a> based on station coordinates.
                Returns TAC-formatted wind (e.g., <code>15010G24KMH</code>).
              </p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="windLabel" value="Station wind" onchange="updateProviderOption('wind', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="windReplaceMode" onchange="toggleReplaceMode('wind')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="windCategory" onchange="toggleCategoryMode('wind')">
                    <span>Category</span>
                  </label>
                  <div class="provider-input" title="Cache configuration: false=disabled, true=indefinite, number=TTL(ms), minute/hour/day=boundary">
                    <span>Cache:</span>
                    <select id="windCache" onchange="updateProviderOption('wind', 'cache', this.value)">
                      <option value="false">Disabled</option>
                      <option value="true">Indefinite</option>
                      <option value="60000">1 min (TTL)</option>
                      <option value="300000">5 min (TTL)</option>
                      <option value="minute">Next minute</option>
                      <option value="hour" selected>Next hour</option>
                      <option value="day">Midnight</option>
                    </select>
                  </div>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="windUserInteraction" onchange="updateProviderOption('wind', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="windTimeout" value="5000" min="0" step="100" onchange="updateProviderOption('wind', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="windProviderEnabled" checked onchange="toggleWindApiProvider()">
                    <span>Enabled</span>
                  </label>
                </div>
              </div>
              <div class="provider-info">
                <p><strong>How it works:</strong></p>
                <ul>
                  <li>Extracts ICAO code from TAC (e.g., LFPG from "METAR LFPG")</li>
                  <li>Looks up station coordinates (demo has: LFPG, LFPO, LFBO, EGLL, EDDF, EHAM)</li>
                  <li>Fetches hourly wind data from Open-Meteo API</li>
                  <li>Returns current hour wind as TAC: <code>dddffGffKMH</code></li>
                </ul>
                <p><strong>Note:</strong> This is a demonstration of API-based providers. In production, you would fetch coordinates from an ICAO database.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- SIGMET/AIRMET Providers -->
        <div id="providers-SIGMET" class="message-type-content">
          <div class="provider-subtabs">
            <button class="provider-subtab active" data-subtab="sigmet-firId" onclick="switchProviderSubtab('SIGMET', 'firId')">FIR/CTA Location</button>
            <button class="provider-subtab" data-subtab="sigmet-mwoId" onclick="switchProviderSubtab('SIGMET', 'mwoId')">MWO Location</button>
            <button class="provider-subtab" data-subtab="sigmet-firName" onclick="switchProviderSubtab('SIGMET', 'firName')">FIR/CTA Name</button>
            <button class="provider-subtab" data-subtab="sigmet-volcanoSigmet" onclick="switchProviderSubtab('SIGMET', 'volcanoSigmet')">Volcano (WV)</button>
            <button class="provider-subtab" data-subtab="sigmet-cyclone" onclick="switchProviderSubtab('SIGMET', 'cyclone')">Cyclone (WC)</button>
          </div>

          <!-- FIR Location Indicator Provider -->
          <div id="sigmet-subcontent-firId" class="provider-subcontent active">
            <div class="provider-card">
              <div class="provider-header">
                <h4>firId</h4>
              </div>
              <p class="provider-desc">ICAO location indicator of ATS unit serving the FIR/CTA (used by SIGMET, AIRMET)</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="firIdLabel" value="" placeholder="(auto)" onchange="updateProviderOption('firId', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="firIdReplaceMode" checked onchange="toggleReplaceMode('firId')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="firIdCategory" onchange="toggleCategoryMode('firId')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="firIdCache" onchange="updateProviderOption('firId', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="firIdUserInteraction" onchange="updateProviderOption('firId', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="firIdTimeout" value="500" min="0" step="100" onchange="updateProviderOption('firId', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="firIdProviderEnabled" checked onchange="toggleProvider('firId')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="firIdDelay" value="0" min="0" step="100" onchange="updateProviderOption('firId', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="firIdProviderJson" spellcheck="false" onchange="updateProviderData('firId')">[
  { "text": "LFFF", "description": "Paris ACC" },
  { "text": "LFBB", "description": "Bordeaux ACC" },
  { "text": "LFMM", "description": "Marseille ACC" },
  { "text": "LFRR", "description": "Brest ACC" },
  { "text": "LFEE", "description": "Reims ACC" }
]</textarea>
                <div id="firIdProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('firId')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>

          <!-- MWO Location Indicator Provider -->
          <div id="sigmet-subcontent-mwoId" class="provider-subcontent">
            <div class="provider-card">
              <div class="provider-header">
                <h4>mwoId (ws/wv/wc/wa.*.*.mwoId)</h4>
              </div>
              <p class="provider-desc">Location indicator of MWO originating the message (format: <code>nnnn</code>, hyphen suffix added by grammar)</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="mwoIdLabel" value="" placeholder="(auto)" onchange="updateProviderOption('mwoId', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="mwoIdReplaceMode" checked onchange="toggleReplaceMode('mwoId')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="mwoIdCategory" onchange="toggleCategoryMode('mwoId')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="mwoIdCache" onchange="updateProviderOption('mwoId', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="mwoIdUserInteraction" onchange="updateProviderOption('mwoId', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="mwoIdTimeout" value="500" min="0" step="100" onchange="updateProviderOption('mwoId', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="mwoIdProviderEnabled" checked onchange="toggleProvider('mwoId')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="mwoIdDelay" value="0" min="0" step="100" onchange="updateProviderOption('mwoId', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="mwoIdProviderJson" spellcheck="false" onchange="updateProviderData('mwoId')">[
  { "text": "LFPW", "description": "Toulouse MWO (France)" },
  { "text": "EGLL", "description": "Exeter MWO (UK)" },
  { "text": "EDDF", "description": "Offenbach MWO (Germany)" },
  { "text": "LIIB", "description": "Rome MWO (Italy)" },
  { "text": "LEMD", "description": "Madrid MWO (Spain)" }
]</textarea>
                <div id="mwoIdProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('mwoId')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>

          <!-- FIR/CTA Name Provider -->
          <div id="sigmet-subcontent-firName" class="provider-subcontent">
            <div class="provider-card">
              <div class="provider-header">
                <h4>firName (ws/wv/wc/wa.*.*.firName)</h4>
              </div>
              <p class="provider-desc">Complete FIR/CTA block: ICAO + name + type (format: <code>nnnn NAME FIR|UIR|FIR/UIR|CTA</code>)</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="firNameLabel" value="" placeholder="(auto)" onchange="updateProviderOption('firName', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="firNameReplaceMode" checked onchange="toggleReplaceMode('firName')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="firNameCategory" onchange="toggleCategoryMode('firName')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="firNameCache" onchange="updateProviderOption('firName', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="firNameUserInteraction" onchange="updateProviderOption('firName', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="firNameTimeout" value="500" min="0" step="100" onchange="updateProviderOption('firName', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="firNameProviderEnabled" checked onchange="toggleProvider('firName')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="firNameDelay" value="0" min="0" step="100" onchange="updateProviderOption('firName', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="firNameProviderJson" spellcheck="false" onchange="updateProviderData('firName')">[
  { "text": "LFFF PARIS FIR", "description": "Paris Flight Information Region" },
  { "text": "LFBB BORDEAUX FIR", "description": "Bordeaux Flight Information Region" },
  { "text": "LFMM MARSEILLE FIR", "description": "Marseille Flight Information Region" },
  { "text": "LFRR BREST FIR", "description": "Brest Flight Information Region" },
  { "text": "LFEE REIMS UIR", "description": "Reims Upper Information Region" },
  { "text": "LFFF PARIS FIR/UIR", "description": "Paris FIR and UIR combined" }
]</textarea>
                <div id="firNameProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('firName')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>

          <!-- Volcano Name Provider (SIGMET WV) -->
          <div id="sigmet-subcontent-volcanoSigmet" class="provider-subcontent">
            <div class="provider-card">
              <div class="provider-header">
                <h4>wv.*.*.volcanoName</h4>
              </div>
              <p class="provider-desc">Name of the volcano for SIGMET volcanic ash messages (MT prefix is a separate suggestion)</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="volcanoSigmetLabel" value="" placeholder="(auto)" onchange="updateProviderOption('volcanoSigmet', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="volcanoSigmetReplaceMode" checked onchange="toggleReplaceMode('volcanoSigmet')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="volcanoSigmetCategory" onchange="toggleCategoryMode('volcanoSigmet')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="volcanoSigmetCache" onchange="updateProviderOption('volcanoSigmet', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="volcanoSigmetUserInteraction" onchange="updateProviderOption('volcanoSigmet', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="volcanoSigmetTimeout" value="500" min="0" step="100" onchange="updateProviderOption('volcanoSigmet', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="volcanoSigmetProviderEnabled" checked onchange="toggleProvider('volcanoSigmet')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="volcanoSigmetDelay" value="0" min="0" step="100" onchange="updateProviderOption('volcanoSigmet', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="volcanoSigmetProviderJson" spellcheck="false" onchange="updateProviderData('volcanoSigmet')">[
  { "text": "ETNA", "description": "Sicily, Italy - 3357m" },
  { "text": "STROMBOLI", "description": "Aeolian Islands, Italy - 926m" },
  { "text": "VESUVIUS", "description": "Naples, Italy - 1281m" },
  { "text": "EYJAFJALLAJOKULL", "description": "Iceland - 1651m" },
  { "text": "GRIMSVOTN", "description": "Iceland - 1725m" }
]</textarea>
                <div id="volcanoSigmetProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('volcanoSigmet')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>

          <!-- Cyclone Name Provider (SIGMET WC) -->
          <div id="sigmet-subcontent-cyclone" class="provider-subcontent">
            <div class="provider-card">
              <div class="provider-header">
                <h4>wc.*.*.tcName</h4>
              </div>
              <p class="provider-desc">Name of the tropical cyclone for SIGMET TC messages</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="cycloneLabel" value="" placeholder="(auto)" onchange="updateProviderOption('cyclone', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="cycloneReplaceMode" checked onchange="toggleReplaceMode('cyclone')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="cycloneCategory" onchange="toggleCategoryMode('cyclone')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="cycloneCache" onchange="updateProviderOption('cyclone', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="cycloneUserInteraction" onchange="updateProviderOption('cyclone', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="cycloneTimeout" value="500" min="0" step="100" onchange="updateProviderOption('cyclone', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="cycloneProviderEnabled" checked onchange="toggleProvider('cyclone')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="cycloneDelay" value="0" min="0" step="100" onchange="updateProviderOption('cyclone', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="cycloneProviderJson" spellcheck="false" onchange="updateProviderData('cyclone')">[
  { "text": "GLORIA", "description": "Atlantic hurricane" },
  { "text": "KATRINA", "description": "Atlantic hurricane (2005)" },
  { "text": "SANDY", "description": "Atlantic hurricane (2012)" },
  { "text": "IRMA", "description": "Atlantic hurricane (2017)" },
  { "text": "HAGIBIS", "description": "Pacific typhoon (2019)" }
]</textarea>
                <div id="cycloneProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('cyclone')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- VAA Providers -->
        <div id="providers-VAA" class="message-type-content">
          <div class="provider-subtabs">
            <button class="provider-subtab active" data-subtab="vaa-volcano" onclick="switchProviderSubtab('VAA', 'volcano')">Volcano Name</button>
          </div>

          <div id="vaa-subcontent-volcano" class="provider-subcontent active">
            <div class="provider-card">
              <div class="provider-header">
                <h4>fv.*.*.volcanoName</h4>
              </div>
              <p class="provider-desc">Volcano name for VAA template (format may include IAVCEI number)</p>
              <div class="provider-controls">
                <div class="provider-row-header">
                  <span class="provider-row-label">Options</span>
                  <span class="provider-spacer"></span>
                  <span class="provider-row-label">Simulation</span>
                </div>
                <div class="provider-row">
                  <div class="provider-input">
                    <span>Label:</span>
                    <input type="text" id="volcanoLabel" value="" placeholder="(auto)" onchange="updateProviderOption('volcano', 'label', this.value)">
                  </div>
                  <label class="provider-toggle" title="Replace grammar suggestions">
                    <input type="checkbox" id="volcanoReplaceMode" checked onchange="toggleReplaceMode('volcano')">
                    <span>Replace</span>
                  </label>
                  <label class="provider-toggle" title="Wrap suggestions in a category">
                    <input type="checkbox" id="volcanoCategory" onchange="toggleCategoryMode('volcano')">
                    <span>Category</span>
                  </label>
                  <label class="provider-toggle" title="Cache suggestions after first load">
                    <input type="checkbox" id="volcanoCache" onchange="updateProviderOption('volcano', 'cache', this.checked)">
                    <span>Cache</span>
                  </label>
                  <label class="provider-toggle" title="Show overlay while waiting for user input">
                    <input type="checkbox" id="volcanoUserInteraction" onchange="updateProviderOption('volcano', 'userInteraction', this.checked)">
                    <span>User Interaction</span>
                  </label>
                  <div class="provider-input">
                    <span>Timeout:</span>
                    <input type="number" id="volcanoTimeout" value="500" min="0" step="100" onchange="updateProviderOption('volcano', 'timeout', this.value)">
                    <span>ms</span>
                  </div>
                  <span class="provider-spacer"></span>
                  <label class="provider-toggle">
                    <input type="checkbox" id="volcanoProviderEnabled" checked onchange="toggleProvider('volcano')">
                    <span>Enabled</span>
                  </label>
                  <div class="provider-input">
                    <span>Delay:</span>
                    <input type="number" id="volcanoDelay" value="0" min="0" step="100" onchange="updateProviderOption('volcano', 'delay', this.value)">
                    <span>ms</span>
                  </div>
                </div>
              </div>
              <div class="provider-json">
                <textarea id="volcanoProviderJson" spellcheck="false" onchange="updateProviderData('volcano')">[
  { "text": "ETNA", "description": "Italy - 0101-06=" },
  { "text": "STROMBOLI", "description": "Italy - 0101-04=" },
  { "text": "VESUVIUS", "description": "Italy - 0101-02=" },
  { "text": "PITON DE LA FOURNAISE", "description": "Réunion - 0303-02=" },
  { "text": "EYJAFJALLAJOKULL", "description": "Iceland - 1702-02=" },
  { "text": "SAKURAJIMA", "description": "Japan - 0802-08=" }
]</textarea>
                <div id="volcanoProviderError" class="provider-json-error" style="display: none;"></div>
                <button class="provider-code-btn" onclick="showProviderCode('volcano')">
                  <span class="material-symbols-outlined">code</span>
                  Show Code
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="info-box" style="margin-top: 1rem;">
        <strong>Options:</strong>
        <ul style="margin: 0.5rem 0 0 1.5rem; color: var(--text-muted); font-size: 0.85rem;">
          <li><strong>Replace</strong> - When ON (default), provider suggestions replace grammar suggestions entirely. When OFF, provider suggestions are added after placeholder, before grammar suggestions.</li>
          <li><strong>Category</strong> - When ON, provider results are wrapped in a submenu category. When OFF (default), suggestions appear as a flat list.</li>
          <li><strong>Show Code</strong> - Displays JavaScript code for provider registration with current settings (with syntax highlighting).</li>
        </ul>
      </div>
    </div>

    <!-- Sample messages -->
    <div class="section-box">
      <h3>Sample Messages (click to load)</h3>
      <div class="samples">
        <div class="sample-card" data-message="METAR LFPG 281030Z 27015KT 9999 FEW040 12/05 Q1023 NOSIG">
          <h4>METAR - Simple</h4>
          <code>METAR LFPG 281030Z 27015KT 9999 FEW040 12/05 Q1023 NOSIG</code>
        </div>
        <div class="sample-card" data-message="METAR LFPG 281030Z 27015G25KT 350V030 9999 FEW040CB SCT100 12/05 Q1023 TEMPO 3000 TSRA">
          <h4>METAR - Complex with gusts and CB</h4>
          <code>METAR LFPG 281030Z 27015G25KT 350V030 9999 FEW040CB SCT100 12/05 Q1023 TEMPO 3000 TSRA</code>
        </div>
        <div class="sample-card" data-message="SPECI EGLL 281045Z 09012KT 3000 BR BKN004 08/07 Q1019">
          <h4>SPECI - Low visibility</h4>
          <code>SPECI EGLL 281045Z 09012KT 3000 BR BKN004 08/07 Q1019</code>
        </div>
        <div class="sample-card" data-message="METAR KJFK 281056Z 32008KT 10SM SCT250 M02/M14 A3042 RMK AO2">
          <h4>METAR - US format (inHg)</h4>
          <code>METAR KJFK 281056Z 32008KT 10SM SCT250 M02/M14 A3042 RMK AO2</code>
        </div>
        <div class="sample-card" data-message="METAR LFBO 281030Z VRB02KT CAVOK 15/08 Q1025">
          <h4>METAR - CAVOK</h4>
          <code>METAR LFBO 281030Z VRB02KT CAVOK 15/08 Q1025</code>
        </div>
        <div class="sample-card" data-message="METAR LSGG 281050Z 04005KT 0400 FG VV002 02/02 Q1031">
          <h4>METAR - Fog with vertical visibility</h4>
          <code>METAR LSGG 281050Z 04005KT 0400 FG VV002 02/02 Q1031</code>
        </div>
        <div class="sample-card" data-message="TAF LFPG 160500Z 1606/1712 24008KT 9999 FEW040 BECMG 1612/1614 SCT030 BKN080">
          <h4>TAF - Simple with BECMG</h4>
          <code>TAF LFPG 160500Z 1606/1712 24008KT 9999 FEW040 BECMG 1612/1614 SCT030 BKN080</code>
        </div>
        <div class="sample-card" data-message="TAF LFPG 160500Z 1606/1712 24008KT 9999 SCT040 TEMPO 1612/1618 4000 TSRA BKN025CB PROB40 1618/1624 2000 +TSRA">
          <h4>TAF - Complex with TEMPO and PROB</h4>
          <code>TAF LFPG 160500Z 1606/1712 24008KT 9999 SCT040 TEMPO 1612/1618 4000 TSRA BKN025CB PROB40 1618/1624 2000 +TSRA</code>
        </div>
        <div class="sample-card" data-message="TAF AMD EGLL 160600Z 1606/1706 18012KT CAVOK FM161200 22015G25KT 9999 SCT040">
          <h4>TAF AMD - Amendment with FM group</h4>
          <code>TAF AMD EGLL 160600Z 1606/1706 18012KT CAVOK FM161200 22015G25KT 9999 SCT040</code>
        </div>
        <div class="sample-card" data-message="TAF LFBO 160500Z 1606/1712 VRB02KT 0400 FG VV002 BECMG 1608/1610 4000 BR BKN010 BECMG 1612/1614 9999 SCT030">
          <h4>TAF - Fog improving</h4>
          <code>TAF LFBO 160500Z 1606/1712 VRB02KT 0400 FG VV002 BECMG 1608/1610 4000 BR BKN010 BECMG 1612/1614 9999 SCT030</code>
        </div>
        <div class="sample-card" data-message="VA ADVISORY
DTG: 20080923/0130Z
VAAC: TOKYO
VOLCANO: KARYMSKY 300130
PSN: N5403 E15927
AREA: RUSSIA
SUMMIT ELEV: 1536M
ADVISORY NR: 2008/4
INFO SOURCE: HIMAWARI-8 KVERT KEMSD
AVIATION COLOUR CODE: RED
ERUPTION DETAILS: ERUPTION AT 20080923/0000Z FL300 REPORTED
OBS VA DTG: 23/0100Z
OBS VA CLD: FL250/300 N5400 E15930 - N5400 E16100 - N5300 E15945 MOV SE 20KT
FCST VA CLD +6 HR: 23/0700Z FL250/350 N5130 E16030 - N5130 E16230 - N5330 E16230 - N5330 E16030
FCST VA CLD +12 HR: 23/1300Z SFC/FL270 N4830 E16130 - N4830 E16600 - N5300 E16600 - N5300 E16130
FCST VA CLD +18 HR: 23/1900Z NO VA EXP
RMK: TWO DISPERSING VA CLD ARE EVIDENT ON SATELLITE IMAGERY
NXT ADVISORY: 20080923/0730Z">
          <h4>VAA - Volcanic Ash Advisory</h4>
          <code>VA ADVISORY - KARYMSKY volcano (Russia)</code>
        </div>
        <div class="sample-card" data-message="TC ADVISORY
DTG: 20040925/1900Z
TCAC: MIAMI
TC: GLORIA
ADVISORY NR: 2004/13
OBS PSN: 25/1800Z N2706 W07306
CB: WI 250NM OF TC CENTRE TOP FL500
MOV: NW 20KMH
INTST CHANGE: INTSF
C: 965HPA
MAX WIND: 22MPS
FCST PSN +6 HR: 25/2200Z N2748 W07350
FCST MAX WIND +6 HR: 22MPS
FCST PSN +12 HR: 26/0400Z N2830 W07430
FCST MAX WIND +12 HR: 22MPS
FCST PSN +18 HR: 26/1000Z N2852 W07500
FCST MAX WIND +18 HR: 21MPS
FCST PSN +24 HR: 26/1600Z N2912 W07530
FCST MAX WIND +24 HR: 20MPS
RMK: NIL
NXT MSG: 20040925/2000Z">
          <h4>TCA - Tropical Cyclone Advisory</h4>
          <code>TC ADVISORY - Hurricane GLORIA (Miami TCAC)</code>
        </div>
        <div class="sample-card" data-message="SWX ADVISORY
DTG: 20161108/0100Z
SWXC: PECASUS
ADVISORY NR: 2016/2
NR RPLC: 2016/1
SWX EFFECT: HF COM MOD AND GNSS MOD
OBS SWX: 08/0100Z HNH HSH E18000 - W18000
FCST SWX +6 HR: 08/0700Z HNH HSH E18000 - W18000
FCST SWX +12 HR: 08/1300Z HNH HSH E18000 - W18000
FCST SWX +18 HR: 08/1900Z HNH HSH E18000 - W18000
FCST SWX +24 HR: 09/0100Z NO SWX EXP
RMK: LOW LVL GEOMAGNETIC STORMING CAUSING INCREASED AURORAL ACT
NXT ADVISORY: NO FURTHER ADVISORIES">
          <h4>SWXA - Space Weather Advisory</h4>
          <code>SWX ADVISORY - HF COM and GNSS moderate degradation</code>
        </div>
      </div>
    </div>

    <!-- Event log -->
    <div class="section-box">
      <h3>Change Events</h3>
      <p>The component emits <code>change</code> events with message type, tokens, and validation status.</p>
      <div class="log-container">
        <pre id="eventLog">Waiting for change events...</pre>
        <button class="btn-clear" onclick="clearEventLog()" title="Clear">✕</button>
      </div>
    </div>

    <!-- HTML Code -->
    <div class="section-box">
      <h3>HTML Code</h3>
      <p>Copy this code to use the component in your own page (updates automatically with your settings)</p>
      <pre id="htmlCode" class="code-example"></pre>
    </div>

    <!-- Footer -->
    <div class="footer">
      <a href="https://www.softwarity.io/" target="_blank" rel="noopener noreferrer">
        <img src="https://www.softwarity.io/img/softwarity.svg" alt="Softwarity">
        <span>Made by Softwarity</span>
      </a>
    </div>
  </div>

  <!-- Sequence Number Provider Modal -->
  <div id="sequenceModal" class="modal-overlay">
    <div class="modal">
      <h3>Sequence Number</h3>
      <p>
        This demo simulates a provider that fetches the next sequence number.
        In a real application, this would query your backend to get the next available sequence.
      </p>
      <div class="modal-input-group">
        <label for="sequenceInput">Sequence number (format: [A-Z]n[n][n])</label>
        <input type="text" id="sequenceInput" placeholder="e.g., A1, B12, C123" maxlength="4">
      </div>
      <div class="modal-info">
        💡 The provider system allows the editor to request external data asynchronously.
        Press <strong>ESC</strong> to cancel, or click outside this modal.
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="cancelSequenceModal()">Cancel</button>
        <button class="btn-confirm" onclick="confirmSequenceModal()">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Theme CSS Modal -->
  <div id="themeModal" class="theme-modal">
    <div class="theme-modal-backdrop" onclick="closeThemeModal()"></div>
    <div class="theme-modal-content">
      <div class="theme-modal-header">
        <h3><span class="material-symbols-outlined">palette</span> Theme CSS</h3>
        <button class="theme-modal-close" onclick="closeThemeModal()">×</button>
      </div>
      <div class="theme-modal-body">
        <p>
          Themes use CSS custom properties with <code>light-dark()</code> for automatic dark/light switching.<br>
          Edit the CSS below and click "Apply" to preview, or "Copy" to use in your project.
        </p>
        <textarea id="themeTextarea" class="theme-textarea" spellcheck="false"></textarea>
        <div class="theme-actions">
          <button class="btn-cancel" onclick="resetTheme()">Reset</button>
          <button class="btn-cancel" onclick="copyTheme()">Copy CSS</button>
          <button class="btn-confirm" onclick="applyTheme()">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Code Modal -->
  <div id="codeModal" class="theme-modal">
    <div class="theme-modal-backdrop" onclick="closeCodeModal()"></div>
    <div class="theme-modal-content" style="max-width: 800px;">
      <div class="theme-modal-header">
        <h3><span class="material-symbols-outlined">code</span> Provider Registration Code</h3>
        <button class="theme-modal-close" onclick="closeCodeModal()">×</button>
      </div>
      <div class="theme-modal-body">
        <p id="codeModalDescription" style="margin-bottom: 1rem;">
          Copy this code to register the suggestion provider in your application.
        </p>
        <div class="code-container">
          <pre id="codeModalPre"><code id="codeModalContent" class="language-javascript"></code></pre>
        </div>
        <div class="theme-actions">
          <button class="btn-cancel" onclick="copyProviderCode()">
            <span class="material-symbols-outlined" style="font-size: 1rem; vertical-align: middle;">content_copy</span>
            Copy Code
          </button>
          <button class="btn-confirm" onclick="downloadCurrentProviderCode()">
            <span class="material-symbols-outlined" style="font-size: 1rem; vertical-align: middle;">download</span>
            Download
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Load the component and built-in validators -->
  <script type="module">
    import '../src/tac-editor.js';
    import { registerBuiltinValidators } from '../src/tac-validators.js';

    // Register built-in validators when editor is ready
    customElements.whenDefined('tac-editor').then(() => {
      const editor = document.getElementById('editor');
      if (editor) {
        // Register built-in validators (by name, referenced in grammar files)
        registerBuiltinValidators(editor);

        // Example: Pattern-based validator for all wind tokens across all grammars
        // Pattern format: codetac.standard.lang.tokenType (use * as wildcard)
        editor.registerValidator('*.*.*.wind', (ctx) => {
          // Example: warn if wind speed is very high (informational only)
          const match = ctx.tokenValue.match(/(\d{2,3})KT/);
          if (match && parseInt(match[1], 10) > 50) {
            return `High wind speed: ${match[1]}KT`;
          }
          return undefined;
        });

        // Example: Multiple patterns for same validator
        // editor.registerValidator(['sa.*.*.icao', 'sp.*.*.icao'], (ctx) => {
        //   if (ctx.tokenValue === 'XXXX') return 'Invalid ICAO code';
        //   return undefined;
        // });

        console.log('Validators registered:', editor.getRegisteredValidators());

        // Example: Pattern-based suggestion provider for temperature
        // When user needs to enter temperature, suggest mock station data
        editor.registerSuggestionProvider('sa.*.*.temperature', {
          provider: async (ctx) => {
            // In real app, fetch from station API based on ICAO code in the TAC
            // For demo, return mock suggestions
            console.log('Temperature provider called:', ctx.tokenType, ctx.grammarCode);
            return [
              { text: '15/12', description: 'Temperature 15°C / Dewpoint 12°C (mock)' },
              { text: 'M02/M05', description: 'Temperature -2°C / Dewpoint -5°C (mock)' }
            ];
          },
          replace: false // Combine with grammar placeholder
        });

        console.log('Providers registered:', editor.getRegisteredSuggestionProviders());
      }
    });
  </script>

  <!-- Prism.js for syntax highlighting (with embedded JS/CSS support) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

  <script>
    const editor = document.getElementById('editor');
    const eventLog = document.getElementById('eventLog');
    const variantSelect = document.getElementById('variantSelect');
    const htmlCode = document.getElementById('htmlCode');
    const colorSchemeToggle = document.getElementById('colorSchemeToggle');

    // Toggle color scheme (Tailwind pattern: html.dark class)
    function toggleColorScheme() {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      colorSchemeToggle.querySelector('span').textContent = isDark ? 'dark_mode' : 'light_mode';
      updateHTMLCode();
    }

    // ==========================================
    // Theme Management
    // ==========================================
    const themeModal = document.getElementById('themeModal');
    const themeTextarea = document.getElementById('themeTextarea');
    const themePresetSelect = document.getElementById('themePresetSelect');
    // Theme CSS files mapping (relative paths)
    const themeCSSFiles = {
      vscode: '../themes/vscode.css',
      monokai: '../themes/monokai.css',
      github: '../themes/github.css',
      solarized: '../themes/solarized.css'
    };

    // Cache for loaded theme CSS content
    const themeCache = {};

    // IntelliJ theme CSS (for modal display only - actual defaults are in tac-editor.css)
    const INTELLIJ_THEME_CSS = `/**
 * IntelliJ IDEA Theme (Default) for @softwarity/tac-editor
 * Built-in theme - no need to load this file.
 * Uses CSS light-dark() for automatic dark/light switching.
 *
 * Usage: This is the default theme. No CSS file needed.
 */

:root {
  /* ========== Editor Base Colors ========== */
  --tac-editor-bg: light-dark(#ffffff, #2b2b2b);
  --tac-editor-text: light-dark(#000000, #a9b7c6);
  --tac-editor-caret: light-dark(#000000, #a9b7c6);
  --tac-editor-border: light-dark(#c4c4c4, #515151);
  --tac-editor-selection: light-dark(rgba(166, 210, 255, 0.5), rgba(33, 66, 131, 0.5));
  --tac-editor-current-line: light-dark(rgba(252, 250, 237, 0.5), rgba(50, 50, 50, 0.5));
  --tac-editor-placeholder: light-dark(#808080, #606060);
  --tac-editor-header-bg: light-dark(#f2f2f2, #3c3f41);
  --tac-editor-footer-bg: light-dark(#f2f2f2, #3c3f41);
  --tac-editor-scrollbar: light-dark(rgba(0, 0, 0, 0.2), rgba(255, 255, 255, 0.2));
  --tac-editor-scrollbar-hover: light-dark(rgba(0, 0, 0, 0.4), rgba(255, 255, 255, 0.4));

  /* ========== Token Colors (10 Generic Styles) ========== */
  /* 1. keyword - Message identifiers, structural keywords */
  --tac-editor-keyword: light-dark(#0033b3, #cc7832);

  /* 2. location - Geographic identifiers (ICAO, FIR, volcanoes, cyclones) */
  --tac-editor-location: light-dark(#00627a, #6897bb);

  /* 3. datetime - Dates, times, validity periods */
  --tac-editor-datetime: light-dark(#1750eb, #6897bb);

  /* 4. phenomenon - Weather phenomena, hazards */
  --tac-editor-phenomenon: light-dark(#871094, #9876aa);

  /* 5. value - Numeric values, measurements */
  --tac-editor-value: light-dark(#067d17, #6a8759);

  /* 6. geometry - Coordinates, directions, zones */
  --tac-editor-geometry: light-dark(#94660c, #ffc66d);

  /* 7. status - State, movement, evolution */
  --tac-editor-status: light-dark(#0033b3, #cc7832);

  /* 8. label - Template labels (VAA/TCA) */
  --tac-editor-label: light-dark(#8c8c8c, #808080);

  /* 9. free-text - Free text content (remarks) */
  --tac-editor-free-text: light-dark(#067d17, #6a8759);

  /* 10. trend - Change groups (BECMG, TEMPO, FM, PROB) */
  --tac-editor-trend: light-dark(#0033b3, #cc7832);

  /* ========== Special Colors ========== */
  --tac-editor-error: light-dark(#ff0000, #ff6b68);
  --tac-editor-error-bg: light-dark(#ffcccc, #3c1f1f);
  --tac-editor-warning: light-dark(#d9a500, #d9a500);
  --tac-editor-valid: light-dark(#067d17, #6a8759);
  --tac-editor-invalid: light-dark(#ff0000, #ff6b68);
  --tac-editor-valid-future: light-dark(#067d17, #6a8759);
  --tac-editor-valid-past: light-dark(#d9a500, #d9a500);

  /* ========== Suggestions ========== */
  --tac-editor-suggestion-bg: light-dark(#ffffff, #3c3f41);
  --tac-editor-suggestion-border: light-dark(#c4c4c4, #515151);
  --tac-editor-suggestion-text: light-dark(#000000, #a9b7c6);
  --tac-editor-suggestion-desc: light-dark(#808080, #808080);
  --tac-editor-suggestion-selected: light-dark(#0052cc, #4b6eaf);
  --tac-editor-suggestion-hover: light-dark(#edf5ff, #4b5052);
}`;

    const THEME_LINK_ID = 'tac-editor-theme-link';
    const THEME_STYLE_ID = 'tac-editor-theme-style';

    // Load theme CSS file via <link> element (works in both Vite and non-Vite)
    function loadThemeCSS(themeName) {
      // Remove current theme link if any
      const existingLink = document.getElementById(THEME_LINK_ID);
      if (existingLink) {
        existingLink.remove();
      }

      // Also remove any custom style from modal editing
      const existingStyle = document.getElementById(THEME_STYLE_ID);
      if (existingStyle) {
        existingStyle.remove();
      }

      // Empty value means default theme (no external CSS - uses built-in IntelliJ)
      if (!themeName) {
        return;
      }

      const cssPath = themeCSSFiles[themeName];
      if (!cssPath) return;

      // Add <link> element like a real user would do
      const link = document.createElement('link');
      link.id = THEME_LINK_ID;
      link.rel = 'stylesheet';
      link.href = cssPath;
      document.head.appendChild(link);
    }

    // Apply custom theme CSS from modal textarea
    function applyCustomThemeCSS(cssContent) {
      // Remove any existing custom style
      const existingStyle = document.getElementById(THEME_STYLE_ID);
      if (existingStyle) {
        existingStyle.remove();
      }

      // Also remove the theme link since we're applying custom CSS
      const existingLink = document.getElementById(THEME_LINK_ID);
      if (existingLink) {
        existingLink.remove();
      }

      // Create and insert new style element
      const style = document.createElement('style');
      style.id = THEME_STYLE_ID;
      style.textContent = cssContent;
      document.head.appendChild(style);
    }

    // Get current theme CSS (for modal display) using fetch
    async function getCurrentThemeCSS() {
      const preset = themePresetSelect.value;
      if (!preset) return INTELLIJ_THEME_CSS;

      if (themeCache[preset]) return themeCache[preset];

      const cssPath = themeCSSFiles[preset];
      if (!cssPath) return INTELLIJ_THEME_CSS;

      // Fetch CSS content
      try {
        const response = await fetch(cssPath);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const cssContent = await response.text();
        themeCache[preset] = cssContent;
        return cssContent;
      } catch (error) {
        console.error('Failed to load theme CSS:', error);
        return INTELLIJ_THEME_CSS;
      }
    }

    // Change theme preset
    async function changeThemePreset() {
      const preset = themePresetSelect.value;
      await loadThemeCSS(preset);
      updateHTMLCode();
    }

    // Open theme modal
    async function openThemeModal() {
      themeTextarea.value = await getCurrentThemeCSS();
      themeModal.classList.add('visible');
      themeTextarea.focus();
    }

    // Close theme modal
    function closeThemeModal() {
      themeModal.classList.remove('visible');
    }

    // Reset theme to preset
    async function resetTheme() {
      themeTextarea.value = await getCurrentThemeCSS();
    }

    // Copy theme CSS to clipboard
    async function copyTheme() {
      try {
        await navigator.clipboard.writeText(themeTextarea.value);
        alert('Theme CSS copied to clipboard!');
      } catch (err) {
        console.error('Failed to copy theme CSS:', err);
      }
    }

    // Apply edited theme CSS from modal
    function applyTheme() {
      const css = themeTextarea.value;
      applyCustomThemeCSS(css);
      closeThemeModal();
    }

    // Handle ESC key to close theme modal
    themeModal.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeThemeModal();
      }
    });

    // No theme applied on load - uses built-in IntelliJ defaults from tac-editor.css

    // Variant change (standard.locale)
    variantSelect.addEventListener('change', () => {
      const [standard, locale] = variantSelect.value.split('.');
      editor.standard = standard;
      editor.lang = locale;
      updateHTMLCode();
    });

    // Update HTML code display
    function updateHTMLCode() {
      const readonly = document.getElementById('readonlyToggle2').checked;
      const observationAuto = document.getElementById('observationAuto').checked;
      const isDark = document.documentElement.classList.contains('dark');
      const [standard, locale] = variantSelect.value.split('.');

      // Get selected types
      const checkboxes = document.querySelectorAll('.types-checkboxes input[type="checkbox"][value]');
      const selectedTypes = Array.from(checkboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      let attrs = [];
      if (readonly) attrs.push('readonly');
      if (observationAuto) attrs.push('observation-auto');
      if (locale && locale !== 'en') attrs.push(`lang="${locale}"`);
      if (standard && standard !== 'oaci') attrs.push(`standard="${standard}"`);
      if (selectedTypes.length > 0) {
        attrs.push(`message-types="${selectedTypes.join(',')}"`);
      }

      // Get selected theme
      const selectedTheme = themePresetSelect.value;

      let code = '<!DOCTYPE html>\n';
      code += `<html lang="en"${isDark ? ' class="dark"' : ''}>\n`;
      code += '<head>\n';
      code += '  <meta charset="UTF-8">\n';
      code += '  <title>TAC Editor</title>\n';
      code += '  <style>\n';
      code += '    /*\n';
      code += '     * Color scheme toggle (Tailwind pattern)\n';
      code += '     * The editor uses CSS light-dark() and inherits color-scheme from parent.\n';
      code += '     * Toggle html.dark class to switch themes.\n';
      code += '     * For Bootstrap: [data-bs-theme="dark"] { color-scheme: dark; }\n';
      code += '     */\n';
      code += '    html.dark { color-scheme: dark; }\n';
      code += '    html:not(.dark) { color-scheme: light; }\n';
      code += '  </style>\n';
      // Add theme link if a theme is selected (not default)
      if (selectedTheme) {
        code += `  <link rel="stylesheet" href="https://unpkg.com/@softwarity/tac-editor/themes/${selectedTheme}.css">\n`;
      }
      code += '</head>\n';
      code += '<body>\n';
      code += '  <tac-editor';
      if (attrs.length > 0) {
        code += '\n    ' + attrs.join('\n    ');
      }
      code += '\n  ></tac-editor>\n\n';
      code += '  <script type="module" src="https://unpkg.com/@softwarity/tac-editor"><\/script>\n';
      code += '  <script type="module">\n';
      code += '    const editor = document.querySelector(\'tac-editor\');\n';
      code += '    \n';
      code += '    // Register a suggestion provider for aerodrome codes\n';
      code += '    editor.registerSuggestionProvider(\'report-aerodrome-location-indicator\', {\n';
      code += '      provider: async ({ tokenType, search, tac, cursorPosition, grammarName }) => {\n';
      code += '        // tokenType:      "report-aerodrome-location-indicator"\n';
      code += '        // search:         What user typed, e.g. "LFP"\n';
      code += '        // tac:            Full editor content, e.g. "METAR LFP"\n';
      code += '        // cursorPosition: Cursor position, e.g. 9\n';
      code += '        // grammarName:    e.g. "sa.oaci.en"\n';
      code += '        \n';
      code += '        // Example: fetch from API\n';
      code += '        // const res = await fetch(`/api/aerodromes?q=${search}`);\n';
      code += '        // return await res.json();\n';
      code += '        \n';
      code += '        // Static example with filtering\n';
      code += '        const aerodromes = [\n';
      code += '          { text: \'LFPG\', description: \'Paris CDG\' },\n';
      code += '          { text: \'LFPO\', description: \'Paris Orly\' },\n';
      code += '          { text: \'EGLL\', description: \'London Heathrow\' }\n';
      code += '        ];\n';
      code += '        return aerodromes.filter(a => a.text.includes(search.toUpperCase()));\n';
      code += '      },\n';
      code += '      replace: true,   // true = replace grammar suggestions, false = extend\n';
      code += '      userInteraction: false, // true = shows overlay with message, false = spinner in popup\n';
      code += '      timeout: 500     // timeout in ms before showing "Loading expired" message\n';
      code += '    });\n';
      code += '  <\/script>\n';
      code += '</body>\n';
      code += '</html>';

      // Apply HTML syntax highlighting with Prism.js
      if (typeof Prism !== 'undefined') {
        htmlCode.innerHTML = Prism.highlight(code, Prism.languages.markup, 'markup');
      } else {
        htmlCode.textContent = code;
      }
    }

    // Update message-types attribute
    function updateTypes() {
      const checkboxes = document.querySelectorAll('.types-checkboxes input[type="checkbox"][value]');
      const selectedTypes = Array.from(checkboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      // Update "All" checkbox state
      const toggleAll = document.getElementById('toggleAllTypes');
      const allChecked = selectedTypes.length === checkboxes.length;
      const noneChecked = selectedTypes.length === 0;
      toggleAll.checked = allChecked;
      toggleAll.indeterminate = !allChecked && !noneChecked;

      if (selectedTypes.length > 0) {
        editor.setAttribute('message-types', selectedTypes.join(','));
      } else {
        editor.removeAttribute('message-types');
      }

      updateHTMLCode();
    }

    // Toggle all message type checkboxes
    function toggleAllTypes() {
      const toggleAll = document.getElementById('toggleAllTypes');
      const checkboxes = document.querySelectorAll('.types-checkboxes input[type="checkbox"][value]');
      checkboxes.forEach(cb => cb.checked = toggleAll.checked);
      toggleAll.indeterminate = false;
      updateTypes();
    }

    // Toggle readonly
    function toggleReadonly() {
      const toggle = document.getElementById('readonlyToggle2');

      if (toggle.checked) {
        editor.setAttribute('readonly', '');
      } else {
        editor.removeAttribute('readonly');
      }

      updateHTMLCode();
    }

    // Toggle observation-auto (include AUTO station entries in METAR/SPECI)
    function toggleObservationAuto() {
      const toggle = document.getElementById('observationAuto');

      if (toggle.checked) {
        editor.setAttribute('observation-auto', '');
      } else {
        editor.removeAttribute('observation-auto');
      }

      updateHTMLCode();
    }

    // Reset editor
    function resetEditor() {
      editor.value = 'METAR LFPG 281030Z 27015KT 9999 FEW040 12/05 Q1023 NOSIG';
    }

    // Copy to clipboard
    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(editor.value);
      } catch (err) {
        console.error('Failed to copy');
      }
    }

    // Clear event log
    function clearEventLog() {
      eventLog.textContent = 'Waiting for change events...';
    }

    // Event listeners
    editor.addEventListener('change', (e) => {
      const { value, type, valid, tokens } = e.detail;
      const line = `[${new Date().toLocaleTimeString()}] type=${type || 'unknown'}, valid=${valid}, tokens=${tokens.length}`;
      const current = eventLog.textContent;
      if (current === 'Waiting for change events...') {
        eventLog.textContent = line;
      } else {
        eventLog.textContent = line + '\n' + current;
      }
    });

    editor.addEventListener('validation-error', (e) => {
      const line = `[${new Date().toLocaleTimeString()}] ERROR: ${e.detail.errors.map(err => err.message).join(', ')}`;
      const current = eventLog.textContent;
      if (current === 'Waiting for change events...') {
        eventLog.textContent = line;
      } else {
        eventLog.textContent = line + '\n' + current;
      }
    });

    // Sample cards
    document.querySelectorAll('.sample-card').forEach(card => {
      card.addEventListener('click', () => {
        editor.value = card.dataset.message;
      });
    });

    // ==========================================
    // Sequence Number Provider Demo
    // ==========================================
    const sequenceModal = document.getElementById('sequenceModal');
    const sequenceInput = document.getElementById('sequenceInput');
    let sequenceResolve = null;
    let sequenceReject = null;

    // Open modal and return promise
    function openSequenceModal(signal) {
      return new Promise((resolve, reject) => {
        sequenceResolve = resolve;
        sequenceReject = reject;

        // Handle abort signal (ESC pressed in editor)
        signal.addEventListener('abort', () => {
          closeSequenceModal();
          reject(new DOMException('Aborted', 'AbortError'));
        });

        // Pre-fill with suggested value
        sequenceInput.value = 'A1';
        sequenceModal.classList.add('visible');
        sequenceInput.focus();
        sequenceInput.select();
      });
    }

    // Close modal without action
    function closeSequenceModal() {
      sequenceModal.classList.remove('visible');
      sequenceResolve = null;
      sequenceReject = null;
    }

    // Cancel button handler
    function cancelSequenceModal() {
      const reject = sequenceReject;
      closeSequenceModal();
      if (reject) {
        reject(new DOMException('Aborted', 'AbortError'));
      }
    }

    // Confirm button handler
    function confirmSequenceModal() {
      const value = sequenceInput.value.trim().toUpperCase();
      const resolve = sequenceResolve;
      closeSequenceModal();
      if (resolve) {
        resolve(value || '1');
      }
    }

    // Click on overlay closes modal
    sequenceModal.addEventListener('click', (e) => {
      if (e.target === sequenceModal) {
        cancelSequenceModal();
      }
    });

    // ESC key closes modal
    sequenceModal.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        e.preventDefault();
        cancelSequenceModal();
      } else if (e.key === 'Enter') {
        e.preventDefault();
        confirmSequenceModal();
      }
    });

    // ==========================================
    // Suggestion Providers Demo
    // ==========================================
    const providerConfigs = {
      // METAR/SPECI aerodrome location indicator
      reportIcao: {
        providerIds: ['sa.*.*.icao', 'sp.*.*.icao'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'METAR'
      },
      // TAF aerodrome location indicator
      tafIcao: {
        providerIds: ['ft.*.*.icao', 'fc.*.*.icao'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'METAR'
      },
      // Weather phenomena (extends grammar, doesn't replace)
      weather: {
        providerIds: ['sa.*.*.weather', 'sp.*.*.weather'],
        replace: false,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'METAR'
      },
      // FIR location indicator (SIGMET + AIRMET + SIGMET WV/WC)
      // Use simple 'firId' without grammar pattern - works for initial menu before grammar is loaded
      firId: {
        providerIds: ['firId'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'SIGMET'
      },
      // MWO location indicator
      mwoId: {
        providerIds: ['ws.*.*.mwoId', 'wv.*.*.mwoId', 'wc.*.*.mwoId', 'wa.*.*.mwoId'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'SIGMET'
      },
      // FIR name
      firName: {
        providerIds: ['ws.*.*.firName', 'wv.*.*.firName', 'wc.*.*.firName', 'wa.*.*.firName'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'SIGMET'
      },
      // Volcano name (SIGMET WV)
      volcanoSigmet: {
        providerIds: ['wv.*.*.volcanoName'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'SIGMET'
      },
      // Tropical cyclone name (SIGMET WC)
      cyclone: {
        providerIds: ['wc.*.*.tcName'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'SIGMET'
      },
      // Volcano name (VAA)
      volcano: {
        providerIds: ['fv.*.*.volcanoName'],
        replace: true,
        category: false,
        delay: 0,
        timeout: 500,
        userInteraction: false,
        cache: false,
        label: '',
        data: null,
        enabled: true,
        messageType: 'VAA'
      },
      // Wind data from Open-Meteo API (METAR/SPECI)
      wind: {
        providerIds: ['sa.*.*.windDirection', 'sp.*.*.windDirection'],
        replace: false,
        category: false,
        delay: 0,
        timeout: 5000,
        userInteraction: false,
        cache: 'hour', // Expire at next hour boundary (hourly weather data)
        label: 'Station wind',
        data: null,
        enabled: true,
        messageType: 'METAR',
        apiProvider: true // Flag to indicate this provider uses API call
      }
    };

    // Switch provider tab (first level - message types)
    function switchMessageTypeTab(messageType) {
      document.querySelectorAll('.message-type-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.type === messageType);
      });
      document.querySelectorAll('.message-type-content').forEach(content => {
        content.classList.toggle('active', content.id === `providers-${messageType}`);
      });
    }

    // Switch provider sub-tab (second level - individual providers)
    function switchProviderSubtab(messageType, providerName) {
      const contentId = `providers-${messageType}`;
      const container = document.getElementById(contentId);
      if (!container) return;

      // Update sub-tab buttons
      container.querySelectorAll('.provider-subtab').forEach(tab => {
        const tabProvider = tab.dataset.subtab.split('-')[1]; // Extract provider name from data-subtab
        tab.classList.toggle('active', tabProvider === providerName);
      });

      // Update sub-content visibility
      const prefix = messageType.toLowerCase();
      container.querySelectorAll('.provider-subcontent').forEach(content => {
        const contentProvider = content.id.replace(`${prefix}-subcontent-`, '');
        content.classList.toggle('active', contentProvider === providerName);
      });
    }

    // Toggle replace mode for a provider
    function toggleReplaceMode(providerName) {
      const checkbox = document.getElementById(`${providerName}ReplaceMode`);
      providerConfigs[providerName].replace = checkbox.checked;

      // Re-register if enabled
      if (providerConfigs[providerName].enabled) {
        registerSuggestionProvider(providerName);
      }
      updateProviderStatus(providerName);
    }

    // Toggle category mode for a provider
    function toggleCategoryMode(providerName) {
      const checkbox = document.getElementById(`${providerName}Category`);
      providerConfigs[providerName].category = checkbox.checked;

      // Re-register if enabled
      if (providerConfigs[providerName].enabled) {
        registerSuggestionProvider(providerName);
      }
      updateProviderStatus(providerName);
    }

    // Current provider for code modal
    let currentCodeProviderName = null;

    // Generate provider registration code
    function generateProviderCode(providerName) {
      const config = providerConfigs[providerName];
      const data = config.data || [];

      // Generate the code
      let code = `// Register suggestion provider for ${providerName}\n`;
      code += `// Provider IDs: ${config.providerIds.join(', ')}\n\n`;

      // Data array - compact format (one object per line)
      const compactJson = '[\n' + data.map(item => '  ' + JSON.stringify(item)).join(',\n') + '\n]';
      code += `const ${providerName}Data = ${compactJson};\n\n`;

      // Provider function - returns data directly (category/label/description are in registration options)
      code += `const ${providerName}Provider = async (context) => {\n`;
      code += `  // context contains: tokenType, search, tac, cursorPosition, grammarName, grammarCode, grammarStandard, grammarLang\n`;
      code += `  console.log(\`[${providerName}] tokenType: \${context.tokenType}, search: "\${context.search}"\`);\n`;
      code += `  return ${providerName}Data;\n`;
      code += `};\n\n`;

      // Registration calls - category/label are OPTIONS, not in payload
      code += `// Register for each provider ID\n`;
      config.providerIds.forEach(providerId => {
        code += `editor.registerSuggestionProvider('${providerId}', {\n`;
        code += `  provider: ${providerName}Provider,\n`;
        code += `  replace: ${config.replace},\n`;
        code += `  timeout: ${config.timeout || 500},\n`;
        code += `  userInteraction: ${config.userInteraction || false},\n`;
        code += `  cache: ${config.cache || false}`;
        if (config.category) {
          code += `,\n  category: true`;
        }
        if (config.label) {
          code += `,\n  label: '${config.label}'`;
        }
        code += `\n});\n`;
      });

      return code;
    }

    // Show provider code in modal
    function showProviderCode(providerName) {
      currentCodeProviderName = providerName;
      const code = generateProviderCode(providerName);
      const config = providerConfigs[providerName];

      // Update description
      document.getElementById('codeModalDescription').innerHTML =
        `Provider: <strong>${config.providerIds.join(', ')}</strong><br>` +
        `Copy this code to register the suggestion provider in your application.`;

      // Set code and highlight
      const codeElement = document.getElementById('codeModalContent');
      codeElement.textContent = code;
      Prism.highlightElement(codeElement);

      // Show modal
      document.getElementById('codeModal').classList.add('visible');
    }

    // Close code modal
    function closeCodeModal() {
      document.getElementById('codeModal').classList.remove('visible');
      currentCodeProviderName = null;
    }

    // Copy provider code to clipboard
    function copyProviderCode() {
      if (!currentCodeProviderName) return;
      const code = generateProviderCode(currentCodeProviderName);
      navigator.clipboard.writeText(code).then(() => {
        alert('Code copied to clipboard!');
      });
    }

    // Download current provider code
    function downloadCurrentProviderCode() {
      if (!currentCodeProviderName) return;
      const code = generateProviderCode(currentCodeProviderName);
      const blob = new Blob([code], { type: 'text/javascript' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${currentCodeProviderName}-provider.js`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Update a provider option (delay, timeout, userInteraction, cache, label)
    function updateProviderOption(providerName, option, value) {
      const config = providerConfigs[providerName];

      // Convert value to appropriate type
      if (option === 'delay' || option === 'timeout') {
        config[option] = parseInt(value, 10) || 0;
      } else if (option === 'userInteraction') {
        config[option] = !!value;
      } else if (option === 'cache') {
        // Cache supports: false, true, number (TTL), 'minute', 'hour', 'day'
        if (value === 'false' || value === false) {
          config[option] = false;
        } else if (value === 'true' || value === true) {
          config[option] = true;
        } else if (!isNaN(parseInt(value, 10))) {
          config[option] = parseInt(value, 10);
        } else {
          config[option] = value; // 'minute', 'hour', 'day'
        }
      } else {
        config[option] = value;
      }

      // Re-register if enabled
      if (config.enabled) {
        registerSuggestionProvider(providerName);
      }
      updateProviderStatus(providerName);
    }

    // Update provider data from JSON textarea
    function updateProviderData(providerName) {
      const textarea = document.getElementById(`${providerName}ProviderJson`);
      const errorDiv = document.getElementById(`${providerName}ProviderError`);

      try {
        const data = JSON.parse(textarea.value);
        providerConfigs[providerName].data = data;
        errorDiv.style.display = 'none';

        // Re-register if enabled
        if (providerConfigs[providerName].enabled) {
          registerSuggestionProvider(providerName);
        }
      } catch (e) {
        errorDiv.textContent = `Invalid JSON: ${e.message}`;
        errorDiv.style.display = 'block';
      }
    }

    // Toggle provider enabled state
    function toggleProvider(providerName) {
      const checkbox = document.getElementById(`${providerName}ProviderEnabled`);
      providerConfigs[providerName].enabled = checkbox.checked;

      if (checkbox.checked) {
        // Parse current JSON data
        updateProviderData(providerName);
        if (providerConfigs[providerName].data) {
          registerSuggestionProvider(providerName);
        }
      } else {
        unregisterSuggestionProvider(providerName);
      }

      updateProviderStatus(providerName);
    }

    // Toggle wind API provider (special case - no JSON data needed)
    function toggleWindApiProvider() {
      const checkbox = document.getElementById('windProviderEnabled');
      providerConfigs.wind.enabled = checkbox.checked;

      if (checkbox.checked) {
        registerSuggestionProvider('wind');
      } else {
        unregisterSuggestionProvider('wind');
      }
    }

    // Default labels for token types (used when no custom label is set)
    const defaultTokenLabels = {
      'icao': 'ICAO location indicator',
      'weather': 'Weather phenomena',
      'firId': 'FIR identifier',
      'mwoId': 'MWO identifier',
      'firName': 'FIR name',
      'volcanoName': 'Volcano name',
      'tcName': 'Tropical cyclone name',
      'windDirection': 'Wind from station'
    };

    // Mock station coordinates (in real app, fetch from ICAO database)
    const stationCoordinates = {
      'LFPG': { lat: 49.0097, lon: 2.5478, name: 'Paris CDG' },
      'LFPO': { lat: 48.7253, lon: 2.3594, name: 'Paris Orly' },
      'LFBO': { lat: 43.6292, lon: 1.3638, name: 'Toulouse' },
      'EGLL': { lat: 51.4700, lon: -0.4543, name: 'London Heathrow' },
      'EDDF': { lat: 50.0379, lon: 8.5622, name: 'Frankfurt' },
      'EHAM': { lat: 52.3086, lon: 4.7639, name: 'Amsterdam' }
    };

    /**
     * Fetch wind data from Open-Meteo API and format as TAC wind group
     * API: https://api.open-meteo.com/v1/forecast
     * Returns: dddffGffKMH format (e.g., 15010G24KMH)
     */
    async function fetchWindFromOpenMeteo(context) {
      // Extract ICAO from TAC (second token after identifier)
      const tacParts = context.tac.trim().split(/\s+/);
      const icao = tacParts.length >= 2 ? tacParts[1] : null;

      // Get coordinates for station (fallback to Berlin for demo)
      const coords = stationCoordinates[icao] || { lat: 52.52, lon: 13.41, name: 'Berlin (demo)' };

      // Get current date in YYYY-MM-DD format
      const today = new Date().toISOString().split('T')[0];

      // Build API URL
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&hourly=wind_speed_10m,wind_direction_10m,wind_gusts_10m&start_date=${today}&end_date=${today}`;

      console.log(`[Wind Provider] Fetching from Open-Meteo for ${icao || 'unknown'} (${coords.name}):`, url);

      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();

        // Get current hour index
        const currentHour = new Date().getUTCHours();

        // Extract wind data for current hour
        const direction = data.hourly.wind_direction_10m[currentHour]; // degrees
        const speed = data.hourly.wind_speed_10m[currentHour];         // km/h
        const gusts = data.hourly.wind_gusts_10m[currentHour];         // km/h

        // Format direction: round to nearest 10 degrees, pad to 3 digits
        const dirFormatted = String(Math.round(direction / 10) * 10).padStart(3, '0');
        // Handle 360 -> 360 (not 000 for wind direction)
        const dirFinal = dirFormatted === '000' ? '360' : dirFormatted;

        // Format speed: round to integer, pad to 2 digits
        const speedFormatted = String(Math.round(speed)).padStart(2, '0');

        // Format gusts: only add if significantly higher than speed (>5 km/h difference)
        let gustPart = '';
        if (gusts > speed + 5) {
          const gustFormatted = String(Math.round(gusts)).padStart(2, '0');
          gustPart = `G${gustFormatted}`;
        }

        // Build TAC wind group (using KMH since API returns km/h)
        const windTac = `${dirFinal}${speedFormatted}${gustPart}KMH`;

        console.log(`[Wind Provider] Result: ${windTac} (dir: ${direction}°, speed: ${speed} km/h, gusts: ${gusts} km/h)`);

        return [{
          text: windTac,
          description: `${coords.name} - ${Math.round(direction)}° at ${Math.round(speed)} km/h${gustPart ? `, gusts ${Math.round(gusts)} km/h` : ''}`
        }];

      } catch (error) {
        console.error('[Wind Provider] API error:', error);
        // Return fallback suggestion on error
        return [{
          text: '00000KMH',
          description: `API error: ${error.message}`
        }];
      }
    }

    // Register suggestion provider for all provider IDs
    function registerSuggestionProvider(providerName) {
      const config = providerConfigs[providerName];
      const data = config.data || [];

      // Choose provider function based on config
      let providerFunction;

      if (config.apiProvider && providerName === 'wind') {
        // Wind provider: fetch from Open-Meteo API
        providerFunction = async (context) => {
          console.log(`[SuggestionProvider:${providerName}] Calling Open-Meteo API...`, context);
          return await fetchWindFromOpenMeteo(context);
        };
      } else {
        // Standard provider: return static data
        providerFunction = async (context) => {
          console.log(`[SuggestionProvider:${providerName}] Called for tokenType: ${context.tokenType}, search: "${context.search}"`, context);

          // Simulate network delay for testing async behavior
          if (config.delay > 0) {
            await new Promise(resolve => setTimeout(resolve, config.delay));
          }

          // Provider always returns flat data - the parser handles category display
          return data;
        };
      }

      config.providerIds.forEach(providerId => {
        const options = {
          provider: providerFunction,
          replace: config.replace,
          category: config.category || false,
          timeout: config.timeout || 500,
          userInteraction: config.userInteraction || false,
          cache: config.cache || false,
          label: config.label || ''
        };
        editor.registerSuggestionProvider(providerId, options);
      });

      console.log(`[Demo] Registered ${providerName} for: ${config.providerIds.join(', ')} (delay: ${config.delay}ms, timeout: ${config.timeout}ms, replace: ${config.replace}, category: ${config.category}, userInteraction: ${config.userInteraction}, cache: ${config.cache}, label: "${config.label}"${config.apiProvider ? ', API provider' : ''})`);
      updateProviderStatus(providerName);
    }

    // Unregister suggestion provider
    function unregisterSuggestionProvider(providerName) {
      const config = providerConfigs[providerName];

      config.providerIds.forEach(providerId => {
        editor.unregisterSuggestionProvider(providerId);
      });

      console.log(`[Demo] Unregistered ${providerName} suggestion provider`);
      updateProviderStatus(providerName);
    }

    // Update provider status - toggle textarea disabled state
    function updateProviderStatus(providerName) {
      const config = providerConfigs[providerName];
      const textarea = document.getElementById(`${providerName}ProviderJson`);
      if (textarea) {
        textarea.disabled = !config.enabled;
      }
    }

    // Initialize provider data from textareas
    function initializeProviders() {
      ['reportIcao', 'tafIcao', 'weather', 'firId', 'mwoId', 'firName', 'volcanoSigmet', 'cyclone', 'volcano'].forEach(providerName => {
        const textarea = document.getElementById(`${providerName}ProviderJson`);
        if (textarea) {
          try {
            providerConfigs[providerName].data = JSON.parse(textarea.value);
          } catch (e) {
            console.warn(`[Demo] Failed to parse initial ${providerName} provider JSON:`, e);
          }
        }
      });
    }

    // Initialize - wait for editor to be ready (grammar loaded)
    customElements.whenDefined('tac-editor').then(() => {
      // Apply initial dark mode (dark by default)
      document.documentElement.classList.add('dark');
      colorSchemeToggle.querySelector('span').textContent = 'dark_mode';
      updateTypes();
      updateHTMLCode();

      // Initialize suggestion providers
      initializeProviders();

      // Register enabled providers on startup
      ['reportIcao', 'tafIcao', 'weather', 'firId', 'mwoId', 'firName', 'volcanoSigmet', 'cyclone', 'volcano', 'wind'].forEach(providerName => {
        const config = providerConfigs[providerName];
        // API providers don't need data, other providers need data
        if (config.enabled && (config.apiProvider || config.data)) {
          registerSuggestionProvider(providerName);
        }
        // Update checkbox state
        const checkbox = document.getElementById(`${providerName}ProviderEnabled`);
        if (checkbox) {
          checkbox.checked = config.enabled;
        }
        updateProviderStatus(providerName);
      });

      // Register the sequence-number provider
      editor.registerProvider('sequence-number', async (request) => {
        console.log('[Provider] sequence-number called with context:', request.context);
        return await openSequenceModal(request.signal);
      });
      console.log('[Demo] Registered sequence-number provider');

      // Wait for grammar to be loaded before setting initial value
      editor.whenReady().then(() => {
        resetEditor();
      });
    });
  </script>
</body>
</html>
